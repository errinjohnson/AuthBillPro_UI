<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link href="css/main.css" rel="stylesheet" />
  </head>
  <body style="background-image: url(img/oceanwavesthemebackgroundl.png);">
     <!-- Navigation Bar -->
     <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#"><img src="img/authbillprologo.png" width="35px" alt="auth bill pro logo">AuthBillPro</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="index.html">DASHBOARD <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="participants.html">Participants</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="authorizationsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Authorizations
                </a>
                <div class="dropdown-menu" aria-labelledby="authorizationsDropdown">
                    <a class="dropdown-item" href="#">Coming Soon - Manage Authorizations</a>
                    <a class="dropdown-item" href="#">Coming Soon - Manage VR Offices</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">--------------</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="activitiesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Activities
                </a>
                <div class="dropdown-menu" aria-labelledby="activitiesDropdown">
                    <a class="dropdown-item" href="#">Coming Soon - Manage Activites</a>
                    <a class="dropdown-item" href="#">Coming Soon - Manage Categories</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">------------------</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="invoicesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Generate Invoice
                </a>
                <div class="dropdown-menu" aria-labelledby="invoicesDropdown">
                    <a class="dropdown-item" href="#">Coming Soon - Generate Invoice</a>
                    <a class="dropdown-item" href="#">Coming Soon - Manage Invoices</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">------------------</a>
                </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="expensesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Expenditures
              </a>
            <div class="dropdown-menu" aria-labelledby="expensesDropdown">
                <a class="dropdown-item" href="#">Coming Soon - Add | Update Expenditures</a>
                <a class="dropdown-item" href="#">Coming Soon - Add Expense Category</a>
                <a class="dropdown-item" href="#">Coming Soon - Add Vendor</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">------------------</a>
            </div>
          </li>
        </ul>
    </div>
  </nav>
  <div class="dashboard-header header">
    <!-- Left: Logo -->
    <div class="header-logo">
        <a href="https://www.oceanwavestech.com/" target="_blank">
            <img src="img/oceanwavestechLogo.jpg" alt="Ocean Waves Logo">
        </a>
    </div>

    <!-- Center: Date & Time -->
    <div class="header-date-time" id="currentDateTime">
        <!-- JavaScript will update this -->
    </div>

    <!-- Right: User info, weather, logout -->
    <div class="header-right">
         <!-- Existing Logout Button -->
        <button class="logout-btn">Logout</button>
    </div>
</div>

  </div>
  <div class="row-container">
    <!-- First Column: Form and Notes Display -->
    <div class="column">
            <!-- Section to display notes in a table -->
        <h3 class="mt-5">Notes List</h3>
        <div class="table-responsive">
            <table class="table table-bordered" id="notesTable">
                <thead>
                    <tr>
                        <th>Note ID</th>
                        <th>Name</th>
                        <th>Note</th>
                        <th>Follow-up</th>
                        <th>Status</th>
                        <th>Action</th>
                   </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Dynamically added notes will appear here -->
                </tbody>
            </table>
        </div>
        <form id="noteForm">
            <!-- Hidden field for note_id (auto_incremented) -->
            <input type="hidden" id="note_id" name="note_id">
            <!-- Note field -->
            <div class="form-group">
                <label class="pt-4" for="note">ADD NOTE:</label>
                <textarea class="form-control" id="note" name="note" rows="3" required></textarea>
            </div>
            <!-- Follow-up date field -->
            <div class="form-group">
                <label for="follow_up">Follow-up Date:</label>
                <input type="date" class="form-control" id="follow_up" name="follow_up">
            </div>
            <!-- Status field -->
            <div class="form-group">
                <label for="status">Status:</label>
                <input type="text" class="form-control" id="status" name="status" maxlength="255">
            </div>
            <!-- Name field -->
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <!-- Submit button -->
            <button type="submit" class="btn btn-primary" id="submitButton">Add Note</button>
        </form>
       </div>
    <!-- Second Column: Empty Placeholder -->
    <div class="empty-column">
        <!-- Weather section -->
        <div id="weather-widget" class="weather-container">
            <div id="forecast-container">
                <!-- Forecast data will be inserted here -->
            </div>
        </div>

    </div>
</div>
    <!-- Include Bootstrap and Custom JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script>
       function updateDateTime() {
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
    document.getElementById('currentDateTime').innerHTML = now.toLocaleDateString('en-US', options);
}

setInterval(updateDateTime, 1000); // Update every second
updateDateTime(); // Initial call

    </script>
    <script>
      // Function to map weather code to description and icon
function getWeatherDescriptionAndIcon(code) {
    const descriptions = {
        0: { description: "Clear Sky", icon: "fas fa-sun" },
        1: { description: "Mainly Clear", icon: "fas fa-sun" },
        2: { description: "Partly Cloudy", icon: "fas fa-cloud-sun" },
        3: { description: "Overcast", icon: "fas fa-cloud" },
        45: { description: "Fog", icon: "fas fa-smog" },
        48: { description: "Depositing Rime Fog", icon: "fas fa-smog" },
        51: { description: "Light Drizzle", icon: "fas fa-cloud-rain" },
        53: { description: "Moderate Drizzle", icon: "fas fa-cloud-rain" },
        55: { description: "Dense Drizzle", icon: "fas fa-cloud-showers-heavy" },
        61: { description: "Slight Rain", icon: "fas fa-cloud-rain" },
        63: { description: "Moderate Rain", icon: "fas fa-cloud-showers-heavy" },
        65: { description: "Heavy Rain", icon: "fas fa-cloud-showers-heavy" },
        71: { description: "Slight Snow", icon: "fas fa-snowflake" },
        73: { description: "Moderate Snow", icon: "fas fa-snowflake" },
        75: { description: "Heavy Snow", icon: "fas fa-snowflake" },
        80: { description: "Slight Rain Showers", icon: "fas fa-cloud-showers-heavy" },
        81: { description: "Moderate Rain Showers", icon: "fas fa-cloud-showers-heavy" },
        82: { description: "Violent Rain Showers", icon: "fas fa-cloud-showers-heavy" }
    };
    return descriptions[code] || { description: "Unknown Condition", icon: "fas fa-question-circle" };
}

// Function to get user's location and fetch weather data and forecast
function getWeather() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            // Fetch weather and 7-day forecast data from Open-Meteo API
            fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode&timezone=auto`)
                .then(response => response.json())
                .then(data => {
                    const forecast = data.daily;

                    // Fetch city name using Nominatim reverse geocoding
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`)
                        .then(response => response.json())
                        .then(locationData => {
                            const city = locationData.address.city || locationData.address.town || locationData.address.village || 'Unknown location';

                            // Build the forecast HTML
                            let forecastHTML = `<h4>7-Day Forecast for ${city}</h4>`;
                            forecastHTML += '<div class="forecast-grid">';
                            for (let i = 0; i < 7; i++) {
                                const date = new Date(forecast.time[i]);
                                const maxTempCelsius = forecast.temperature_2m_max[i];
                                const minTempCelsius = forecast.temperature_2m_min[i];
                                const precipitation = forecast.precipitation_sum[i];
                                const weatherCode = forecast.weathercode[i];

                                // Convert Celsius to Fahrenheit
                                const maxTempFahrenheit = (maxTempCelsius * 9/5) + 32;
                                const minTempFahrenheit = (minTempCelsius * 9/5) + 32;

                                // Get weather description and icon based on weather code
                                const weatherData = getWeatherDescriptionAndIcon(weatherCode);

                                forecastHTML += `
                                    <div class="forecast-day">
                                        <h5>${date.toDateString()}</h5>
                                        <i class="${weatherData.icon} weather-icon"></i>
                                        <p>${weatherData.description}</p>
                                        <p>Max: ${maxTempFahrenheit.toFixed(1)}°F, Min: ${minTempFahrenheit.toFixed(1)}°F</p>
                                        <p>Precipitation: ${precipitation} mm</p>
                                    </div>
                                `;
                            }
                            forecastHTML += '</div>';

                            // Display forecast in the weather widget
                            document.getElementById('forecast-container').innerHTML = forecastHTML;
                        })
                        .catch(error => {
                            weatherWidget.innerHTML = "Could not retrieve city name.";
                            console.error('City fetch error:', error);
                        });
                })
                .catch(error => {
                    weatherWidget.innerHTML = "Error fetching weather data.";
                    console.error('Error:', error);
                });
        }, error => {
            weatherWidget.innerHTML = "Unable to retrieve your location.";
            console.error('Geolocation error:', error);
        });
    } else {
        weatherWidget.innerHTML = "Geolocation is not supported by this browser.";
    }
}

// Call the function to fetch and display the weather
getWeather();



    </script>
    <script src="js/notes.js"></script>
  </body>
</html>
